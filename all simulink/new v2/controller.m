q = [0.1; 0.2];
sq = [0.1; 0.2];
dq = [0.4; 0.6];
W = ones(26, 1);  % 长度为 26，全为 1 的列向量
e13_com = 0.5; e14_com = 0.7;  % 设定 e13_com 和 e14_com 的值
qd3 = 0.3; qd4 = 0.4; dqd3 = 0.2; dqd4 = 0.1; ddqd3 = 0.6; ddqd4 = 0.8;  % 设定其他值
% 2)控制器增益
k13=15;k14=15;    k23=1;k24=1;    k33=100;k34=100;
K1=[k13;k14];     K2=[k23;k24];   K3=[k33;k34];
K1=diag(K1);      K2=diag(K2);    K3=diag(K3);
% 3)双环BLF
rho_13=.008;rho_14=.008;  rho_33=.5;rho_34=.5;
rho_11=rho_13;rho_12=rho_14;  rho_31=rho_33;rho_32=rho_34;
% 4)RBFNN            
nodes=13;  Tau11=60;Tau12=60;  eta1=0.01;  b=60;
c=[-30 -25 -20 -15 -10 -5 0 5 10 15 20 25 30;
   -30 -25 -20 -15 -10 -5 0 5 10 15 20 25 30];
e1_com=[e13_com;e14_com];
qd=[qd3;qd4]; 
dqd=[dqd3;dqd4];
ddqd=[ddqd3;ddqd4];

% 四、误差信号
e1=sq-qd;
% e1=q-(qd-.5*e1_com); % OK
de1=dq-dqd;

% 五、虚拟控制器
miu=-K1*e1+dqd;
dmiu=-K1*de1+ddqd;

% 六、辅助误差信号
e2=dq-miu;
e3=K2*e1+e2;

% 七、双环BLF
%     1)外环
            u_BLF1=[e1(1)/(rho_11^2-e1(1)^2);
                    e1(2)/(rho_12^2-e1(2)^2)];     % u_BLF1：2行1列
%     2)内环
            u_BLF2_denominator_1=rho_31^2-e3(1)^2;
            u_BLF2_denominator_2=rho_32^2-e3(2)^2;
            u_BLF2=[e3(1)/u_BLF2_denominator_1;
                    e3(2)/u_BLF2_denominator_2];   % u_BLF2：2行1列
            Gain_3=diag([u_BLF2_denominator_1;u_BLF2_denominator_2]);

% 八、RBFNN
%     1)RBF Kernel 
            xi1=[sq(1);dq(1)];xi2=[sq(2);dq(2)];
            h1=zeros(nodes,1);h2=zeros(nodes,1);
            for j=1:1:nodes
                h1(j)=exp(-norm(xi1-c(:,j))^2/(b*b));
                h2(j)=exp(-norm(xi2-c(:,j))^2/(b*b));
            end
%      2)estimate
            W1=W(1:nodes,1);W2=W(nodes+1:2*nodes,1);
            fn=[W1'*h1;W2'*h2];

% 九、真实控制器
%     1) 6行6列的模型矩阵
            q3=q(1);q4=q(2);
            M11 = (3932438768524053*cos(q4))/590295810358705651712 - (9666515293019412421*sin(2*q3 + q4))/147573952589676412928 - (7347855351585683*cos(2*q3))/18014398509481984 - (36945533070432904259*cos(2*q3 + 2*q4))/2361183241434822606848 - (2242006792538445303*sin(2*q3 + 2*q4))/1208925819614629174706176 - (3932438768524053*cos(2*q3 + q4))/590295810358705651712 + (9666515293019412421*sin(q4))/147573952589676412928 + 6993021903434165153791/9444732965739290427392;
            M12 = (1566193994333460609165*cos(q3 + q4 + pi/2))/75557863725914323419136 - (260291698974264027*sin(q3 + q4 + pi/2))/151115727451828646838272 - (158738597992664517*sin(q3 + pi/2))/1152921504606846976 - 23750155206264607/144115188075855872;
            M13 = (1566193994333460609165*cos(q3 + q4 + pi/2))/75557863725914323419136 - (260291698974264027*sin(q3 + q4 + pi/2))/151115727451828646838272 - (158738597992664517*sin(q3 + pi/2))/1152921504606846976;
            M14 = (1566193994333460609165*cos(q3 + q4 + pi/2))/75557863725914323419136 - (260291698974264027*sin(q3 + q4 + pi/2))/151115727451828646838272;
            M15 = - (3951197109736239241155*cos(q3 + q4 + pi/2))/75557863725914323419136 - (2242006792538445279*sin(q3 + q4 + pi/2))/1208925819614629174706176 - (3932438768524053*cos(q3 + pi/2))/590295810358705651712 - 2364964252341131/5316911983139663491615228241121378304;
            M16 = (392149993849384621*cos(q3 + q4 + pi/2))/75557863725914323419136 - (260291698974264035*sin(q3 + q4 + pi/2))/151115727451828646838272;
            M22 = (6599725983735443*cos(q3))/4503599627370496 + (3932438768524053*cos(q4))/295147905179352825856 + (9666515293019412421*sin(q4))/73786976294838206464 + (8575983760191473*cos(q3)*cos(q4))/590295810358705651712 + (21081034709077362555*cos(q3)*sin(q4))/147573952589676412928 + (21081034709077362555*cos(q4)*sin(q3))/147573952589676412928 - (8575983760191473*sin(q3)*sin(q4))/590295810358705651712 + 802526512685661487937/295147905179352825856;
            M23 = (6599725983735443*cos(q3))/9007199254740992 + (3932438768524053*cos(q4))/295147905179352825856 + (9666515293019412421*sin(q4))/73786976294838206464 + (8575983760191473*cos(q3)*cos(q4))/1180591620717411303424 + (21081034709077362555*cos(q3)*sin(q4))/295147905179352825856 + (21081034709077362555*cos(q4)*sin(q3))/295147905179352825856 - (8575983760191473*sin(q3)*sin(q4))/1180591620717411303424 + 292870962545184539457/295147905179352825856;
            M24 = (3932438768524053*cos(q4))/590295810358705651712 + (9666515293019412421*sin(q4))/147573952589676412928 + (8575983760191473*cos(q3)*cos(q4))/1180591620717411303424 + (21081034709077362555*cos(q3)*sin(q4))/295147905179352825856 + (21081034709077362555*cos(q4)*sin(q3))/295147905179352825856 - (8575983760191473*sin(q3)*sin(q4))/1180591620717411303424 + 36296309188291035969/295147905179352825856;
            M25 = (2230692869490939*sin(q4))/1152921504606846976 + (304047738388393*cos(q3)*sin(q4))/144115188075855872 + (304047738388393*cos(q4)*sin(q3))/144115188075855872 + 315508820003156273/2361183241434822606848;
            M26 = (3932438768524053*cos(q4))/590295810358705651712 + (2962264730236869*sin(q4))/147573952589676412928 + (8575983760191473*cos(q3)*cos(q4))/1180591620717411303424 + (6460198293038971*cos(q3)*sin(q4))/295147905179352825856 + (6460198293038971*cos(q4)*sin(q3))/295147905179352825856 - (8575983760191473*sin(q3)*sin(q4))/1180591620717411303424 + 29720514162674078529/590295810358705651712;
            M33 = (3932438768524053*cos(q4))/295147905179352825856 + (9666515293019412421*sin(q4))/73786976294838206464 + 292870962545184539457/295147905179352825856;
            M34 = (3932438768524053*cos(q4))/590295810358705651712 + (9666515293019412421*sin(q4))/147573952589676412928 + 36296309188291035969/295147905179352825856;
            M35 = (2230692869490939*sin(q4))/1152921504606846976 + 315508820003156273/2361183241434822606848;
            M36 = (3932438768524053*cos(q4))/590295810358705651712 + (2962264730236869*sin(q4))/147573952589676412928 + 29720514162674078529/590295810358705651712;
            M44 = 0.1230;
            M45 = 1.3362e-04;
            M46 = 0.0503;
            M55 = 0.0529;
            M56 = 1.2030e-06;
            M66 = 0.0503;
            M_66 = [M11 M12 M13 M14 M15 M16;
                    M12 M22 M23 M24 M25 M26;   
                    M13 M23 M33 M34 M35 M36;   
                    M14 M24 M34 M44 M45 M46;   
                    M15 M25 M35 M45 M55 M56;   
                    M16 M26 M36 M46 M56 M66];
%     2) 核心组件
            Tau_parts=-K2*de1-K3*e3-fn+dmiu-Gain_3*u_BLF1-diag([0.5;0.5])*u_BLF2; % Torque_parts: 2行1列
%     3) 六维输出
            Tau=M_66*[0;0;Tau_parts;0;0]
            aaa = [-49.01672779378893;
629.0353329662372;
375.27494263275497;
80.20701276629259;
0.20939346743381607;
31.06466438622798;];
            Tau - aaa